<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Graph Practice</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <link th:href="@{/css/style.css}" rel="stylesheet" />
    <script th:src="@{/js/getweather.js}"></script>
    <style>
        .button {
            width: 100%; /* 버튼의 너비를 컨테이너에 맞춥니다. */
            margin-bottom: 10px !important; /* 버튼 사이의 수직 간격을 줄입니다. */
            padding: 20px 10px !important;
        }

        /* 사용자 지정 버튼 색상 */
        .btn-custom {
            background-color: #F7F8E0;
            border-color: #F7F8E0;
        }

        .btn-custom:hover {
            background-color: #F2F5A9;
        }


        /* 각 row에 대한 간격을 조정합니다. */
        .row {
            margin-right: -15px; /* 부트스트랩 row의 음수 마진을 재조정합니다. */
            margin-left: -15px; /* 부트스트랩 row의 음수 마진을 재조정합니다. */
        }

        /* 각 컬럼의 패딩을 조정하여 간격을 동일하게 만듭니다. */
        .row, .row > [class*='col-'] {
            padding-right: 5px; /* 컬럼 오른쪽 패딩을 줄입니다. */
            padding-left: 5px; /* 컬럼 왼쪽 패딩을 줄입니다. */
        }

        /* 부트스트랩 그리드 간격을 조정할 수 있는 클래스 추가 */
        .gap {
            gap: 15px; /* grid-gap 속성으로 열 사이의 간격을 조정합니다. */
        }


    </style>
</head>

<body>

<div class="container">
<!-- 단계별 리스트 컨테이너, 초기에는 step1만 표시 -->
    <div id="step1-container" class="step-container">
        <div id="step1-list" class="row"> <!-- 변경된 부분: ul이 아닌 div로 수정 -->
        </div>
    </div>

    <div id="step2-container" class="step-container" style="display:none;">
        <button onclick="goBackToStep1()" class="btn btn-secondary mb-3">&lt;</button>
        <div id="step2-list" class="row">
        </div>
    </div>

    <div id="step3-container" class="step-container" style="display:none;">
        <button onclick="goBackToStep2()" class="btn btn-secondary mb-3">&lt;</button>
        <div id="step3-list" class="row">
        </div>
    </div>

</div>

<p id="coordinates-display"></p>


<script> // 3선택

function goBackToStep1() {
    document.getElementById('step1-container').style.display = 'block';
    document.getElementById('step2-container').style.display = 'none';
    document.getElementById('step3-container').style.display = 'none';
}

function goBackToStep2() {
    document.getElementById('step2-container').style.display = 'block';
    document.getElementById('step3-container').style.display = 'none';
}

document.addEventListener('DOMContentLoaded', function() {
    fetchCities();
});

function fetchCities() {
    fetch('/api/cities')
        .then(response => response.json())
        .then(citiesData => {
            const step1List = document.getElementById('step1-list');
            step1List.innerHTML = ''; // 기존 목록을 지웁니다.
            citiesData.forEach((city) => {
                const colDiv = document.createElement('div');
                // 부트스트랩에서 3열로 정렬하기 위해 col-lg-4를 사용합니다.
                colDiv.className = 'col-lg-4 d-flex justify-content-center align-items-stretch';
                const button = document.createElement('button');
                button.textContent = city;
                button.className = 'btn btn-custom button my-2 button my-2'; // 부트스트랩 버튼 클래스 사용
                button.onclick = function() { onStep1Clicked(city); };
                colDiv.appendChild(button);
                step1List.appendChild(colDiv);
            });
        })
        .catch(error => console.error('Error fetching cities:', error));
}


function onStep1Clicked(cityValue) {
    fetch(`/api/districts/${encodeURIComponent(cityValue)}`)
        .then(response => response.json())
        .then(districtsData => {
            const step2List = document.getElementById('step2-list');
            step2List.innerHTML = ''; // 기존 목록을 지웁니다.
            districtsData.forEach((district) => {
                if (district.trim() !== '') { // 값이 있는 경우에만 버튼 생성
                    const colDiv = document.createElement('div');
                    colDiv.className = 'col-lg-4 d-flex justify-content-center align-items-stretch mb-3';
                    const button = document.createElement('button');
                    button.textContent = district;
                    button.className = 'btn btn-custom button my-2 button my-2'; // 부트스트랩 버튼 클래스 사용
                    button.onclick = function() { onStep2Clicked(cityValue, district); };
                    colDiv.appendChild(button);
                    step2List.appendChild(colDiv);
                }
            });
            document.getElementById('step2-container').style.display = 'block';
            document.getElementById('step1-container').style.display = 'none';
        })
        .catch(error => console.error('Error fetching districts:', error));
}

function onStep2Clicked(cityValue, districtValue) {
    fetch(`/api/subdistricts/${encodeURIComponent(cityValue)}/${encodeURIComponent(districtValue)}`)
        .then(response => response.json())
        .then(subdistrictsData => {
            const step3List = document.getElementById('step3-list');
            step3List.innerHTML = ''; // 기존 목록을 지웁니다.
            subdistrictsData.forEach((subdistrict) => {
                if (subdistrict.trim() !== '') { // 값이 있는 경우에만 버튼 생성
                    const colDiv = document.createElement('div');
                    colDiv.className = 'col-lg-4 d-flex justify-content-center align-items-stretch mb-3';
                    const button = document.createElement('button');
                    button.textContent = subdistrict;
                    button.className = 'btn btn-custom button my-2 button my-2'; // 부트스트랩 버튼 클래스 사용
                    button.onclick = function() { onStep3Clicked(cityValue, districtValue, subdistrict); };
                    colDiv.appendChild(button);
                    step3List.appendChild(colDiv);
                }
            });
            document.getElementById('step3-container').style.display = 'block'; // step3 컨테이너를 보여줍니다.
            document.getElementById('step2-container').style.display = 'none'; // step2 컨테이너를 숨깁니다.
        })
        .catch(error => console.error('Error fetching subdistricts:', error));
}


    function onStep3Clicked(city, district, subdistrict) {
        fetch(`/api/coordinates?city=${encodeURIComponent(city)}&district=${encodeURIComponent(district)}&subdistrict=${encodeURIComponent(subdistrict)}`)
            .then(response => response.json())
            .then(location => {
                if(location) {
                    console.log('Coordinates:', location);
                    // 좌표 정보를 DOM에 표시하거나 다른 처리를 할 수 있습니다.
                    // 예를 들어, 아래 코드를 사용하여 HTML 요소에 좌표를 표시할 수 있습니다.
                    document.getElementById('coordinates-display').textContent = `X: ${location.X}, Y: ${location.Y}`;
                } else {
                    console.error('Location not found');
                }
            })
            .catch(error => console.error('Error:', error));
    }


</script>
</body>
</html>
