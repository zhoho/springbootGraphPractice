<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Graph Practice</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <link th:href="@{/css/style.css}" rel="stylesheet" />
    <script th:src="@{/js/getweather.js}"></script>
</head>

<body>

<!-- 단계별 리스트 컨테이너, 초기에는 step1만 표시 -->
<div id="step1-container" class="step-container">
    <ul id="step1-list" class="list-inline">
        <li class="list-inline-item"><button onclick="onStep1Clicked('서울특별시')">서울특별시</button></li>
        <li class="list-inline-item"><button onclick="onStep1Clicked('대전광역시')">대전광역시</button></li>

        <!-- 나머지 step1 아이템들도 같은 방식으로 추가 -->
    </ul>
</div>

<div id="step2-container" class="step-container" style="display:none;">
    <button onclick="goBackToStep1()"><</button>
    <ul id="step2-list" class="list-inline">
    </ul>
</div>

<div id="step3-container" class="step-container" style="display:none;">
    <button onclick="goBackToStep2()"><</button>
    <ul id="step3-list" class="list-inline">
    </ul>
</div>

<p id="coordinates-display"></p>


<script> // 3선택

function goBackToStep1() {
    document.getElementById('step1-container').style.display = 'block';
    document.getElementById('step2-container').style.display = 'none';
    document.getElementById('step3-container').style.display = 'none';
}

function goBackToStep2() {
    document.getElementById('step2-container').style.display = 'block';
    document.getElementById('step3-container').style.display = 'none';
}
function onStep1Clicked(cityValue) {
    fetch(`/api/districts/${encodeURIComponent(cityValue)}`)
        .then(response => response.json())
        .then(districtsData => {
            const step2List = document.getElementById('step2-list');
            step2List.innerHTML = '';
            districtsData.forEach((district) => {
                const listItem = document.createElement('li');
                listItem.className = 'list-inline-item';
                const button = document.createElement('button');
                button.textContent = district;
                // Step2의 버튼에 대한 클릭 이벤트로 onStep2Clicked 함수에 cityValue도 함께 전달합니다.
                button.onclick = function() { onStep2Clicked(cityValue, district); };
                listItem.appendChild(button);
                step2List.appendChild(listItem);
            });
            document.getElementById('step2-container').style.display = 'block';
            document.getElementById('step1-container').style.display = 'none';
        })
        .catch(error => console.error('Error fetching districts:', error));
}

function onStep2Clicked(cityValue, districtValue) {
    fetch(`/api/subdistricts/${encodeURIComponent(cityValue)}/${encodeURIComponent(districtValue)}`)
        .then(response => response.json())
        .then(subdistrictsData => {
            const step3Container = document.getElementById('step3-container');
            const step3List = document.getElementById('step3-list');
            step3List.innerHTML = '';
            subdistrictsData.forEach((subdistrict) => {
                const listItem = document.createElement('li');
                listItem.className = 'list-inline-item';
                const button = document.createElement('button');
                button.textContent = subdistrict;
                // 여기에서 cityValue, districtValue, subdistrict을 onStep3Clicked로 전달합니다.
                button.onclick = function() { onStep3Clicked(cityValue, districtValue, subdistrict); };
                listItem.appendChild(button);
                step3List.appendChild(listItem);
            });
            step3Container.style.display = 'block'; // step3 컨테이너를 보여줍니다.
            document.getElementById('step2-container').style.display = 'none'; // step2 컨테이너를 숨깁니다.
        })
        .catch(error => console.error('Error fetching subdistricts:', error));
}

    function onStep3Clicked(city, district, subdistrict) {
        fetch(`/api/coordinates?city=${encodeURIComponent(city)}&district=${encodeURIComponent(district)}&subdistrict=${encodeURIComponent(subdistrict)}`)
            .then(response => response.json())
            .then(location => {
                if(location) {
                    console.log('Coordinates:', location);
                    // 좌표 정보를 DOM에 표시하거나 다른 처리를 할 수 있습니다.
                    // 예를 들어, 아래 코드를 사용하여 HTML 요소에 좌표를 표시할 수 있습니다.
                    document.getElementById('coordinates-display').textContent = `X: ${location.X}, Y: ${location.Y}`;
                } else {
                    console.error('Location not found');
                }
            })
            .catch(error => console.error('Error:', error));
    }


</script>
</body>
</html>
